services:
  web:
    build:
      context: .
      target: dev
    ports:
      - "3000:3000"
    env_file:
      - .env.local
    environment:
      NODE_ENV: development
    volumes:
      # ソースをマウントしてホットリロード
      - .:/app:cached
      # node_modules はコンテナ側を使う（ホストで上書きしない）
      - node_modules:/app/node_modules
      # Next のビルドキャッシュもコンテナ内に保持（任意）
      - next_cache:/app/.next
    # Mac/Windowsでファイル変更検知が弱い時に有効
    # environment:
    #   CHOKIDAR_USEPOLLING: "true"

volumes:
  node_modules:
  next_cache: